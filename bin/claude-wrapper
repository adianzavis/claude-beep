#!/usr/bin/expect -f

# Simple expect wrapper that replaces claude command

# Path to the original claude (Node.js version)
set original_claude "/Users/adrian/.nvm/versions/node/v22.12.0/lib/node_modules/@anthropic-ai/claude-code/cli.js"

# Get command line arguments
set claude_args [lrange $argv 0 end]

# If no arguments provided, add default argument to avoid Node.js confusion
if {[llength $claude_args] == 0} {
    set claude_args [list "--help"]
}

# Variables to track beep timing
set last_beep_time 0

# Start the original claude process with node
spawn node $original_claude {*}$claude_args

# Set timeout to never timeout
set timeout -1

# Make expect transparent - pass through all input/output
interact {
    -o -re "(Do you want to proceed\\?|Opened changes in| 1\\. Yes  )" {
        # Only beep if it's been at least 10 seconds since last beep
        set current_time [clock seconds]
        if {$current_time >= [expr $last_beep_time + 10]} {
            # Execute beep-disturb command
            catch {
                exec beep-disturb &
            }
            set last_beep_time $current_time
        }
    }
}