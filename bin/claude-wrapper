#!/usr/bin/expect -f

# Simple expect wrapper that replaces claude command

# Path to the original claude (Node.js version)
set original_claude "/Users/adrian/.nvm/versions/node/v22.12.0/lib/node_modules/@anthropic-ai/claude-code/cli.js"

# Get command line arguments
set claude_args [lrange $argv 0 end]

# If no arguments provided, add default argument to avoid Node.js confusion
if {[llength $claude_args] == 0} {
    set claude_args [list "--help"]
}

# Allow a beep once per prompt; re-arm only on user Enter
set can_beep 1

# Start the original claude process with node
spawn node $original_claude {*}$claude_args

# Set timeout to never timeout
set timeout -1

# Watch output in background without affecting display
expect_background -re {(Do you want to (proceed\?|make (this|[0-9]+) edit(s)?.*\?)|Opened changes in|[[:space:]]*[â¯> ]?[[:space:]]*1\.[[:space:]]*Yes([[:space:]]|$))} {
    if {$can_beep} {
        catch { exec beep-disturb & }
        set can_beep 0
    }
}

# Transparent pass-through; re-arm strictly on Enter
interact {
    -re {\r} {
        # Re-arm on user's Enter and pass it through
        set can_beep 1
        send -- $interact_out(0,string)
    }
}
